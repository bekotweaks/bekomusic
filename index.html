<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beko Music</title>
  <!-- Spotify Web Playback SDK -->
  <script src="https://sdk.scdn.co/spotify-player.js"></script>

  <!-- ORIGINAL CSS (UNCHANGED) -->
  <style>
    :root{--primary-green:#1DB954;--dark-bg:#121212;--darker-bg:#000;--light-bg:#181818;--text-primary:#fff;--text-secondary:#b3b3b3;--hover-bg:#282828;}
    *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;}
    body{background:var(--dark-bg);color:var(--text-primary);padding-bottom:90px;}
    .header{background:var(--darker-bg);padding:16px 20px;position:fixed;top:0;left:0;right:0;z-index:1000;display:flex;justify-content:space-between;align-items:center;}
    .logo{font-size:24px;font-weight:bold;color:var(--primary-green);}
    .nav-tabs{display:flex;background:var(--darker-bg);position:fixed;top:60px;left:0;right:0;z-index:999;}
    .nav-tab{flex:1;padding:16px;text-align:center;background:none;border:none;color:var(--text-secondary);font-size:16px;cursor:pointer;border-bottom:2px solid transparent;}
    .nav-tab.active{color:var(--text-primary);border-bottom-color:var(--primary-green);}
    .content{margin-top:120px;padding:20px;min-height:calc(100vh - 210px);}
    .tab-content{display:none;}.tab-content.active{display:block;}
    .song-row{margin-bottom:32px;}.row-title{font-size:22px;font-weight:bold;margin-bottom:16px;}
    .songs-container{display:flex;gap:16px;overflow-x:auto;padding-bottom:10px;-webkit-overflow-scrolling:touch;}
    .songs-container::-webkit-scrollbar{height:0;}
    .song-card{min-width:150px;cursor:pointer;transition:transform .2s;}.song-card:hover{transform:scale(1.05);}
    .song-artwork{width:150px;height:150px;border-radius:8px;background:var(--light-bg);margin-bottom:12px;position:relative;overflow:hidden;}
    .song-artwork img{width:100%;height:100%;object-fit:cover;}
    .play-overlay{position:absolute;bottom:8px;right:8px;width:40px;height:40px;background:var(--primary-green);border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s;}
    .song-card:hover .play-overlay{opacity:1;}
    .song-title{font-size:14px;font-weight:600;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .song-artist{font-size:12px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .search-container{margin-bottom:20px;}.search-input{width:100%;padding:12px 16px;background:var(--light-bg);border:none;border-radius:24px;color:var(--text-primary);font-size:16px;outline:none;}
    .search-input::placeholder{color:var(--text-secondary);}
    .result-item{display:flex;align-items:center;padding:12px;border-radius:8px;cursor:pointer;transition:background .2s;}.result-item:hover{background:var(--hover-bg);}
    .result-artwork{width:56px;height:56px;border-radius:4px;background:var(--light-bg);margin-right:16px;}
    .result-info{flex:1;}.result-title{font-size:16px;margin-bottom:4px;}.result-subtitle{font-size:14px;color:var(--text-secondary);}
    .player{position:fixed;bottom:0;left:0;right:0;background:var(--darker-bg);border-top:1px solid var(--light-bg);padding:16px;z-index:1001;}
    .progress-bar{position:absolute;top:0;left:0;right:0;height:2px;background:var(--light-bg);}.progress-fill{height:100%;background:var(--primary-green);width:0%;transition:width .1s linear;}
    .player-content{display:flex;align-items:center;gap:16px;}.player-artwork{width:56px;height:56px;border-radius:4px;background:var(--light-bg);}
    .player-info{flex:1;min-width:0;}.player-title{font-size:14px;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .player-artist{font-size:12px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .player-controls{display:flex;align-items:center;gap:16px;}.control-btn{background:none;border:none;color:var(--text-primary);cursor:pointer;padding:8px;border-radius:50%;transition:background .2s;}.control-btn:hover{background:var(--hover-bg);}
    .control-btn.play-pause{width:40px;height:40px;background:var(--text-primary);color:var(--darker-bg);}
    .queue-container{position:fixed;bottom:90px;right:20px;background:var(--light-bg);border-radius:8px;padding:16px;max-height:300px;overflow-y:auto;display:none;box-shadow:0 4px 12px rgba(0,0,0,.3);}.queue-container.show{display:block;}
    .queue-header{font-size:16px;font-weight:bold;margin-bottom:12px;}.queue-item{display:flex;align-items:center;padding:8px;border-radius:4px;cursor:pointer;font-size:14px;}.queue-item:hover{background:var(--hover-bg);}
    .icon{width:24px;height:24px;fill:currentColor;}.icon-small{width:16px;height:16px;}
  </style>
</head>
<body>
  <!-- ORIGINAL HTML (UNCHANGED) -->
  <div class="header"><div class="logo">Beko Music</div></div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('home')">Home</button>
    <button class="nav-tab" onclick="switchTab('search')">Search</button>
  </div>

  <div class="content">
    <div id="home" class="tab-content active">
      <div class="song-row"><h2 class="row-title">Recently Played</h2><div class="songs-container" id="recently-played"></div></div>
      <div class="song-row"><h2 class="row-title">Because you played...</h2><div class="songs-container" id="recommended"></div></div>
      <div class="song-row"><h2 class="row-title">Trending Now</h2><div class="songs-container" id="trending"></div></div>
    </div>
    <div id="search" class="tab-content">
      <div class="search-container"><input type="text" class="search-input" placeholder="What do you want to listen to?" oninput="handleSearch(this.value)"></div>
      <div class="search-results" id="search-results"></div>
    </div>
  </div>

  <div class="player">
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <div class="player-content">
      <img class="player-artwork" id="player-artwork" src="" alt=""><div class="player-info">
        <div class="player-title" id="player-title">No song playing</div>
        <div class="player-artist" id="player-artist">-</div>
      </div>
      <div class="player-controls">
        <button class="control-btn" onclick="previousTrack()"><svg class="icon" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
        <button class="control-btn play-pause" onclick="togglePlayPause()"><svg class="icon" id="play-pause-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
        <button class="control-btn" onclick="nextTrack()"><svg class="icon" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg></button>
        <button class="control-btn" onclick="toggleQueue()"><svg class="icon" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg></button>
      </div>
    </div>
  </div>

  <div class="queue-container" id="queue"><div class="queue-header">Up Next</div><div id="queue-list"></div></div>

  <!-- =====  NEW JAVASCRIPT (SPOTIFY FULL-TRACK)  ===== -->
  <script>
    /* ---------- 1.  CONFIG  ---------- */
    const CLIENT_ID = 'YOUR_SPOTIFY_CLIENT_ID';   // ← paste yours
    const REDIRECT  = 'https://bekotweaks.github.io/bekomusic/'; // exact GitHub Pages URL
    const SCOPES    = 'streaming user-read-email user-read-private user-modify-playback-state';

    /* ---------- 2.  TOKEN (AUTO)  ---------- */
    let ACCESS_TOKEN = localStorage.getItem('spotify_token');
    if (!ACCESS_TOKEN || Date.now() > (localStorage.getItem('spotify_expires')||0)) {
      const hash = location.hash.match(/access_token=([^&]*)/);
      if (hash) {
        ACCESS_TOKEN = hash[1];
        localStorage.setItem('spotify_token', ACCESS_TOKEN);
        localStorage.setItem('spotify_expires', Date.now() + 3600*1000);
        history.replaceState({}, document.title, window.location.pathname);
      } else location.href = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT)}&scope=${encodeURIComponent(SCOPES)}&show_dialog=false`;
    }

    /* ---------- 3.  SEARCH (METADATA)  ---------- */
    async function searchSpotify(q) {
      if (!q || q.length<2) return [];
      const res = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(q)}&type=track&limit=25`, { headers: { Authorization: `Bearer ${ACCESS_TOKEN}` } });
      const json = await res.json();
      return json.tracks.items.map(t => ({
        id: t.id, title: t.name, artist: t.artists.map(a=>a.name).join(', '),
        album: t.album.name, artwork: t.album.images[0]?.url, uri: t.uri
      }));
    }

    /* ---------- 4.  WEB PLAYBACK SDK  ---------- */
    let device_id = null;
    let player    = null;
    window.onSpotifyWebPlaybackSDKReady = () => {
      player = new Spotify.Player({ name: 'Beko Music', getOAuthToken: cb => cb(ACCESS_TOKEN), volume: 0.8 });
      player.addListener('ready', ({ device_id: id }) => { device_id = id; });
      player.addListener('player_state_changed', state => {
        if (!state) return;
        const progress = (state.position / state.duration) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        isPlaying = !state.paused;
        updatePlayPauseIcon();
      });
      player.connect();
    };

    /* ---------- 5.  PLAYBACK WRAPPER  ---------- */
    let currentSong = null, isPlaying = false, queue = [], currentQueueIndex = 0, recentlyPlayed = [];
    async function playSong(song, offset = 0) {
      currentSong = song;
      await fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
        method: 'PUT', headers: { Authorization: `Bearer ${ACCESS_TOKEN}`, 'Content-Type': 'application/json' },
        body: JSON.stringify({ uris: [song.uri], position_ms: offset })
      });
      document.getElementById('player-artwork').src = song.artwork;
      document.getElementById('player-title').textContent  = song.title;
      document.getElementById('player-artist').textContent = song.artist;
      if (!recentlyPlayed.find(s=>s.id===song.id)) { recentlyPlayed.push(song); loadRecentlyPlayed(); }
      if (!queue.find(s=>s.id===song.id)) { queue.push(song); updateQueue(); }
      currentQueueIndex = queue.findIndex(s=>s.id===song.id);
      isPlaying = true; updatePlayPauseIcon();
    }
    async function togglePlayPause() {
      if (!currentSong) { if (queue.length) playSong(queue[0]); return; }
      player.togglePlay().then(() => { isPlaying = !isPlaying; updatePlayPauseIcon(); });
    }
    function updatePlayPauseIcon() { document.getElementById('play-pause-icon').innerHTML = isPlaying ? '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>' : '<path d="M8 5v14l11-7z"/>'; }
    async function nextTrack() { if (queue.length) { currentQueueIndex = (currentQueueIndex+1)%queue.length; playSong(queue[currentQueueIndex]); } }
    async function previousTrack() { currentQueueIndex = (currentQueueIndex||queue.length)-1; if (queue.length) playSong(queue[currentQueueIndex]); }

    /* ---------- 6.  SEARCH TAB  ---------- */
    async function handleSearch(q) {
      const box = document.getElementById('search-results'); if (q.length<2) { box.innerHTML=''; return; }
      const tracks = await searchSpotify(q); box.innerHTML='';
      if (!tracks.length) { box.innerHTML = '<p style="color:#888;text-align:center">No results</p>'; return; }
      tracks.forEach(t => {
        const div = document.createElement('div'); div.className = 'result-item'; div.onclick = () => playSong(t);
        div.innerHTML = `<img class="result-artwork" src="${t.artwork}" alt=""><div class="result-info"><div class="result-title">${t.title}</div><div class="result-subtitle">${t.artist} · ${t.album}</div></div>`;
        box.appendChild(div);
      });
    }

    /* ---------- 7.  HOME ROWS  ---------- */
    async function loadHomeContent() {
      loadRecentlyPlayed();
      const fallback = await searchSpotify('post malone');
      if (recentlyPlayed.length) {
        const similar = await searchSpotify(recentlyPlayed[recentlyPlayed.length-1].artist);
        renderRow('recommended', similar.slice(0,5));
      } else renderRow('recommended', fallback.slice(0,5));
      renderRow('trending', fallback.slice(0,10));
    }
    function loadRecentlyPlayed() { const box = document.getElementById('recently-played'); box.innerHTML = ''; recentlyPlayed.slice(-5).forEach(s => box.appendChild(createSongCard(s))); }
    function renderRow(id, songs) { const box = document.getElementById(id); box.innerHTML = ''; songs.forEach(s => box.appendChild(createSongCard(s))); }
    function createSongCard(song) {
      const card = document.createElement('div'); card.className = 'song-card'; card.onclick = () => playSong(song);
      card.innerHTML = `<div class="song-artwork"><img src="${song.artwork}" alt=""><div class="play-overlay"><svg class="icon-small" fill="#fff" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div><div class="song-title">${song.title}</div><div class="song-artist">${song.artist}</div>`;
      return card;
    }

    /* ---------- 8.  QUEUE  ---------- */
    function toggleQueue() { document.getElementById('queue').classList.toggle('show'); }
    function updateQueue() {
      const list = document.getElementById('queue-list'); list.innerHTML = '';
      queue.forEach((s,i) => { const d = document.createElement('div'); d.className = 'queue-item'; d.onclick = () => { currentQueueIndex = i; playSong(s); }; d.textContent = `${s.title} - ${s.artist}`; list.appendChild(d); });
    }

    /* ---------- 9.  NAV  ---------- */
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      event.target.classList.add('active');
    }

    /* ---------- 10.  CLOSE QUEUE ON OUTSIDE CLICK  ---------- */
    document.addEventListener('click', e => { const q = document.getElementById('queue'); if (!q.contains(e.target) && !e.target.closest('.control-btn[onclick="toggleQueue()"]')) q.classList.remove('show'); });

    /* ---------- 11.  BOOT  ---------- */
    window.onload = () => { loadHomeContent(); };
  </script>
</body>
</html>